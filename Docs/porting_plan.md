# Overview
- Цель: перенести движок и игру Pocket Palm Heroes с C++ (modules: `pheroes`, `gxlib`, `iolib`) на C# (UWP, Monogame), сохранив логику игры, UI и данные.
- Подход: инкрементальный порт с адаптацией систем ввода/рендера/аудио и контента через Monogame Content Pipeline.

# Architecture Mapping
- Цикл приложения: `iGXApp.Run/Cycle` → `Game.Update/Draw` (Monogame).
- Менеджер представлений: `iViewMgr` → C# `ViewManager` (стек вьюшек, модалки, таймеры).
- Рендеринг: `iDisplay/iDib` → `SpriteBatch` + `Texture2D` + отрисовка примитивов/спрайтов.
- Ввод: `iInput` (клавиши/ориентация/WM сообщения) → `Keyboard`, `Mouse`, `TouchPanel` (Monogame), возможный акселерометр.
- Аудио: `iSoundPlayer` → `SoundEffect`/`Song` (MediaPlayer) в Monogame.
- Игра: `iGame` (меню/оверленд/бой) → классы состояний/вьюшек в C# с тем же API.
- Файлы/пути: `gxl.file.cpp` → `System.IO` и `ContentManager`, ресурсные пути через Pipeline.

# Stages
1) Базовый каркас
- Создать C# `ViewManager` и интерфейсы `IGame`, `IView`.
- Включить цикл `Update/Draw` и роутинг ввода к активной вьюшке.
- Заглушки: Menu/Overland/Battle с минимальной отрисовкой.

2) Контент и ресурсы
- Переименовать `pheroes\\bin` → `AssetsRaw`/`ContentRaw`.
- Описать импортёр/конвертер для графики/звука (по возможности XNB), временно — прямые загрузчики файлов из `AssetsRaw`.

3) Игровая логика
- Перенести `iGame.MainMenu/StartNewGame/ExitGame/Process` в C# стейт-машину.
- Перенести обработчики ввода (`OnKeyDown/OnKeyUp`) и таймерные события.
- Поднять базовый оверленд (карта, скролл, выделение) без боя.

4) UI и взаимодействия
- Портировать `iPopupView`, диалоги, тултипы.
- Текст/шрифты: заменить `iDibFont` на `SpriteFont` и/или отрисовку bitmap-фонтами.

5) Бой и AI
- Перенести боевой экран, инициативу, действия, эффекты.
- Восстановить базовый AI передвижений/решений.

6) Сохранения и совместимость
- Формат сейвов: определить совместимость/миграцию.
- Настроить пути данных UWP и разрешения.

7) Тестирование и полировка
- Модульные проверки ключевых систем (ввод/рендер/звук).
- Валидация производительности и корректности логики.

# Assets Strategy
- Источник: `pheroes\\bin` (каноническая папка исходных ресурсов).
- План: перенос в `AssetsRaw` и постепенная конверсия в Content Pipeline (XNB где возможно).
- Временный режим: прямые загрузчики из файлов, маппинг путей, чтобы быстро показать экран меню.

# Risks & Mitigations
- Пропр. форматы `game.gfx/.sfx`: сложность конверсии → временно прямой ридер/конвертер, позже полноценный импортер.
- Различия ввода (WinCE→UWP): обеспечить абстракцию ввода и маппинг.
- Отрисовка `iDib`→`SpriteBatch`: возможные артефакты → поэтапная валидация слоёв.

# Next Steps
- Реализовать C# `ViewManager` и заглушки вьюшек.
- Подготовить `AssetsRaw` из `pheroes\\bin` и вывести первый экран меню.
- Начать перенос `iGame.Process` и маршрутизацию к вьюшкам.
